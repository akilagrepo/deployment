free server like t3 medium.. workflow - on push - default branch main - runners - ubuntu - path of dockerfile - build docker image - ecs like docker push - give path for deployment yaml file - take image - deploy on eks. check permission for push image iam credetials secret files yaml. set

1. server with t2/t3 micro

1.1 Install git
1.2 clone the code repo
1.3 ssh-keygen -t ed25519 -C "ec2-instance-1@example.com"
1.4 cat ~/.ssh/id_ed25519.pub
1.5 ssh -T git@github.com (Test connection)
1.6 sudo apt install zip unzip -y


2. Install aws cli check: aws --version

3. aws configure
   check: aws sts get-caller-identity

4. Install kubectl check: kubectl version --client

5. Install EKSctl check: eksctl version

6. create eks cluster


   eksctl create cluster \
--name ak-cluster-10 \
--region ap-southeast-1 \
--nodegroup-name my-nodes \
--node-type t2.medium \
--nodes 1 \
--nodes-min 1 \
--nodes-max 3 \
--managed

aws eks list-clusters --region ap-southeast-1


7. create sample nodejs application
   https://github.com/akilagrepo/deployment

8. create repo: aws ecr create-repository --repository-name myapp --region ap-southeast-1
   get the repo url: 435023700720.dkr.ecr.ap-southeast-1.amazonaws.com/ak-app

9.  check cluster : aws eks list-clusters --region ap-southeast-1   : ak-cluster-10 :


10. update kubeconfig:  aws eks update-kubeconfig --name ak-cluster-9 --region ap-southeast-1
    Added new context arn:aws:eks:ap-southeast-1:435023700720:cluster/ak-cluster-9 to /home/ubuntu/.kube/config

11.  kubectl get nodes
NAME                                                STATUS   ROLES    AGE   VERSION
ip-192-168-73-245.ap-southeast-1.compute.internal   Ready    <none>   90s   v1.34.2-eks-ecaa3a6

12. Install docker

13.  login to ecr: aws ecr get-login-password --region ap-southeast-1 | docker login --username AWS --password-stdin 435023700720.dkr.ecr.ap-southeast-1.amazonaws.com
 Login Succeeded

13.1 clone the url
    cd deployment - go inside the folder

14. Build docker
    docker build -t myapp .

15. Add tag to docker image: docker tag mydeployment-app 435023700720.dkr.ecr.ap-southeast-1.amazonaws.com

16. Push the docker image in ecr repo : docker push 435023700720.dkr.ecr.ap-southeast-1.amazonaws.com

17. kubectl apply -f deployment.yaml

18. kubectl get pods
kubectl get svc

19. Create IAM user for github-actions-user

20. Add repo secrets in git hub: https://github.com/akilagrepo/deployment/settings/secrets/actions accesskey, region, secret key. ecr repo, eks cluster name

21. Create GitHub Actions Workflow  .github/workflows/deploy.yml

22. update git push from ec2 to github... for connecting u may use git sh or ssh methos or token based method 

